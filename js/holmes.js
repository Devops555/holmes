!function(o,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):o.holmes=t()}(this,function(){"use strict";function o(t){function e(){if(o.prototype.input instanceof HTMLInputElement)return o.prototype.input.value.toLowerCase();if(o.prototype.input.contentEditable)return o.prototype.input.textContent.toLowerCase();throw new Error("The Holmes input was no <input> or contenteditable.")}function p(t){o.prototype.options.class.visible&&t.classList.remove(o.prototype.options.class.visible),t.classList.contains(o.prototype.options.class.hidden)||(t.classList.add(o.prototype.options.class.hidden),o.prototype.hidden++,"function"==typeof o.prototype.options.onHidden&&o.prototype.options.onHidden(t)),o.prototype.options.hiddenAttr&&t.setAttribute("hidden","true"),o.prototype.options.mark&&(t.innerHTML=t.innerHTML.replace(/<\/?mark>/g,""))}function n(t){o.prototype.options.class.visible&&t.classList.add(o.prototype.options.class.visible),t.classList.contains(o.prototype.options.class.hidden)&&(t.classList.remove(o.prototype.options.class.hidden),o.prototype.hidden--,"function"==typeof o.prototype.options.onVisible&&o.prototype.options.onVisible(t)),o.prototype.options.hiddenAttr&&t.removeAttribute("hidden"),o.prototype.options.mark&&(t.innerHTML=t.innerHTML.replace(/<\/?mark>/g,""),o.prototype.searchString.length&&(t.innerHTML=t.innerHTML.replace(o.prototype.regex,"<mark>$1</mark>")))}function r(){var t=!1;o.prototype.searchString=e(),o.prototype.options.minCharacters&&0!==o.prototype.searchString.length&&o.prototype.options.minCharacters>o.prototype.searchString.length||(o.prototype.options.dynamic&&(o.prototype.elements=document.querySelectorAll(o.prototype.options.find),o.prototype.elementsLength=o.prototype.elements.length,o.prototype.elementsArray=Array.prototype.slice.call(o.prototype.elements)),o.prototype.options.mark&&(o.prototype.regex=new RegExp("("+o.prototype.searchString+")(?![^<]*>)","gi")),o.prototype.elementsArray.forEach(function(e){e.textContent.toLowerCase().indexOf(o.prototype.searchString)===-1?p(e):(n(e),i&&"function"==typeof o.prototype.options.onFound&&o.prototype.options.onFound(o.prototype.placeholderNode),i=!1,t=!0)}),"function"==typeof o.prototype.options.onInput&&o.prototype.options.onInput(o.prototype.searchString),t||i?i||o.prototype.options.placeholder&&o.prototype.placeholderNode.classList.add(o.prototype.options.class.hidden):(i=!0,o.prototype.options.placeholder&&o.prototype.placeholderNode.classList.remove(o.prototype.options.class.hidden),"function"==typeof o.prototype.options.onEmpty&&o.prototype.options.onEmpty(o.prototype.placeholderNode)))}var i=!1;if("object"!=typeof t)throw new Error('The options need to be given inside an object like this:\nholmes({\n\tfind:".result"\n});\nsee also https://haroen.me/holmes/doc/module-holmes.html');if("string"!=typeof t.find)throw new Error('A find argument is needed. That should be a querySelectorAll for each of the items you want to match individually. You should have something like: \nholmes({\n\tfind:".result"\n});\nsee also https://haroen.me/holmes/doc/module-holmes.html');o.prototype.options={input:"input[type=search]",find:void 0,placeholder:void 0,mark:!1,class:{visible:void 0,hidden:"hidden"},dynamic:!1,instant:!1,minCharacters:0,hiddenAttr:!1,onHidden:void 0,onVisible:void 0,onEmpty:void 0,onFound:void 0,onInput:void 0},o.prototype._mergeObj=function(t,e){if(!(t instanceof Object&&e instanceof Object))throw new Error("One of both arguments isn't an object.");Object.keys(t).forEach(function(p){typeof e[p]!=typeof t[p]&&void 0!==t[p]||(e[p]instanceof Object?o.prototype._mergeObj(t[p],e[p]):t[p]=e[p])})},o.prototype._mergeObj(o.prototype.options,t),o.prototype.start=function(){if(o.prototype.running=!0,o.prototype.input=document.querySelector(o.prototype.options.input),!o.prototype.options.find)throw new Error('A find argument is needed. That should be a querySelectorAll for each of the items you want to match individually. You should have something like: \nholmes({\n\tfind:".result"\n});\nsee also https://haroen.me/holmes/doc/module-holmes.html');if(o.prototype.elements=document.querySelectorAll(o.prototype.options.find),o.prototype.elementsLength=o.prototype.elements.length,o.prototype.elementsArray=Array.prototype.slice.call(o.prototype.elements),o.prototype.hidden=0,o.prototype.options.placeholder){if(o.prototype.placeholderNode=document.createElement("div"),o.prototype.placeholderNode.id="holmes-placeholder",o.prototype.placeholderNode.classList.add(o.prototype.options.class.hidden),o.prototype.placeholderNode.innerHTML=o.prototype.options.placeholder,!(o.prototype.elements[0].parentNode instanceof Element))throw new Error("The Holmes placeholder could't be put; the elements had no parent.");o.prototype.elements[0].parentNode.appendChild(o.prototype.placeholderNode)}o.prototype.options.class.visible&&o.prototype.elementsArray.forEach(function(t){t.classList.add(o.prototype.options.class.visible)}),o.prototype.input.addEventListener("input",r)},e.prototype.set=function(t){if(o.prototype.input instanceof HTMLInputElement)o.prototype.input.value=t;else{if(!o.prototype.input.contentEditable)throw new Error("The Holmes input was no <input> or contenteditable.");o.prototype.input.textContent=t}},"boolean"!=typeof o.prototype.options.instant&&(o.prototype.options.instant=!1),o.prototype.options.instant?o.prototype.start(t):window.addEventListener("DOMContentLoaded",function(){o.prototype.start(t)}),o.prototype.stop=function(){return new Promise(function(t,e){try{if(o.prototype.input.removeEventListener("input",r),o.prototype.options.placeholder){if(!o.prototype.placeholderNode.parentNode)throw new Error("The Holmes placeholderNode has no parent.");o.prototype.placeholderNode.parentNode.removeChild(o.prototype.placeholderNode)}o.prototype.options.mark&&o.prototype.elementsArray.forEach(function(o){o.innerHTML=o.innerHTML.replace(/<\/?mark>/g,"")}),o.prototype.running=!1,t("This instance of Holmes has been stopped.")}catch(o){e(o)}})},o.prototype.clear=function(){e.prototype.set(""),o.prototype.options.class.visible?o.prototype.elementsArray.forEach(function(t){t.classList.remove(o.prototype.options.class.hidden),t.classList.add(o.prototype.options.class.visible)}):o.prototype.elementsArray.forEach(function(t){t.classList.remove(o.prototype.options.class.hidden)}),o.prototype.options.placeholder&&(o.prototype.placeholderNode.classList.add(o.prototype.options.class.hidden),o.prototype.options.class.visible&&o.prototype.placeholderNode.classList.remove(o.prototype.options.class.visible)),o.prototype.hidden=0},o.prototype.count=function(){return{all:o.prototype.elementsLength,hidden:o.prototype.hidden,visible:o.prototype.elementsLength-o.prototype.hidden}}}return o});
